# å­ä¼šè¯ä»»åŠ¡åˆ†é…æ–‡æ¡£

**ç”Ÿæˆæ—¶é—´**: 2026-02-03
**ä¸»ä¼šè¯æ¨¡å‹**: claude-opus-4-5-20251101-thinking
**å­ä¼šè¯æ¨¡å‹**: zz,glm-4.7
**é¡¹ç›®**: Small-Squaretable (SillyTavern SaaS è½¬æ¢)

---

## ğŸ“‹ ä»»åŠ¡æ€»è§ˆ

| ä»»åŠ¡ID | ä»»åŠ¡åç§° | çŠ¶æ€ | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ |
|--------|----------|------|--------|----------|
| #1 | æµ‹è¯•è§’è‰²å¸‚åœºé¡µé¢ | in_progress | P0 | 15åˆ†é’Ÿ |
| #2 | æµ‹è¯•æ³¨å†Œæµç¨‹ | pending | P0 | 10åˆ†é’Ÿ |
| #3 | æµ‹è¯•ç™»å½•æµç¨‹ | pending | P0 | 10åˆ†é’Ÿ |
| #4 | æµ‹è¯•ç™»å‡ºæµç¨‹ | pending | P0 | 5åˆ†é’Ÿ |

**æ€»è®¡**: 4ä¸ªä»»åŠ¡ï¼Œçº¦40åˆ†é’Ÿ

---

## ğŸ¯ ä»»åŠ¡ #1: æµ‹è¯•è§’è‰²å¸‚åœºé¡µé¢

### ä»»åŠ¡æè¿°
éªŒè¯è§’è‰²å¸‚åœºé¡µé¢çš„ä¸‰æ®µå¼æ§åˆ¶å°å¸ƒå±€å’Œäº¤äº’åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚

### å‰ç½®æ¡ä»¶
- âœ… åç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:3000
- âœ… å‰ç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:5173 æˆ– 5175
- âœ… æ•°æ®åº“ä¸­æœ‰æµ‹è¯•æ•°æ®ï¼ˆè‡³å°‘1ä¸ªå…¬å¼€è§’è‰² "Rina"ï¼‰

### æ‰§è¡Œæ­¥éª¤

#### 1. ç¡®è®¤å‰ç«¯æœåŠ¡ç«¯å£
```bash
# æ£€æŸ¥å‰ç«¯è¿è¡Œç«¯å£
lsof -ti:5173 && echo "Frontend on 5173" || lsof -ti:5175 && echo "Frontend on 5175"
```

#### 2. è®¿é—®è§’è‰²å¸‚åœºé¡µé¢
```bash
# ä½¿ç”¨æµè§ˆå™¨è®¿é—®ï¼ˆæ ¹æ®å®é™…ç«¯å£è°ƒæ•´ï¼‰
# http://localhost:5173/market
# æˆ–
# http://localhost:5175/market
```

#### 3. éªŒè¯ä¸‰æ®µå¼å¸ƒå±€
- [ ] **å·¦ä¾§å¯¼èˆªæ **
  - é»˜è®¤å®½åº¦ 64pxï¼ˆæ”¶èµ·çŠ¶æ€ï¼‰
  - é¼ æ ‡æ‚¬åœå±•å¼€è‡³ 240px
  - æ˜¾ç¤ºå¯¼èˆªå›¾æ ‡å’Œæ–‡å­—
  - åŒ…å«è·¯ç”±ï¼šé¦–é¡µã€èŠå¤©ã€å¸‚åœºã€æˆ‘çš„è§’è‰²ã€è®¢é˜…ã€è®¾ç½®

- [ ] **é¡¶éƒ¨æ **
  - æœç´¢æ¡†ç»„åˆï¼ˆæœç´¢è¾“å…¥ + åˆ†ç±»ä¸‹æ‹‰ + æœç´¢æŒ‰é’®ï¼‰
  - ç”¨æˆ·èœå•ï¼ˆå³ä¸Šè§’ï¼‰
  - é«˜åº¦å›ºå®šï¼ŒèƒŒæ™¯ç™½è‰²

- [ ] **ä¸»å†…å®¹åŒº**
  - ç­›é€‰å·¥å…·æ ï¼ˆæ’åºã€ç­›é€‰æŒ‰é’®ï¼‰
  - è§’è‰²ç½‘æ ¼ï¼ˆå“åº”å¼å¸ƒå±€ï¼‰
  - ç©ºçŠ¶æ€é¡µé¢ï¼ˆæ— æœç´¢ç»“æœæ—¶ï¼‰

#### 4. æµ‹è¯•äº¤äº’åŠŸèƒ½
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼Œæµ‹è¯•æœç´¢åŠŸèƒ½
// 1. è¾“å…¥æœç´¢å…³é”®è¯ "Rina"
// 2. ç‚¹å‡»æœç´¢æŒ‰é’®
// 3. è§‚å¯Ÿ Network æ ‡ç­¾ï¼ŒéªŒè¯ API è¯·æ±‚
// é¢„æœŸè¯·æ±‚: GET /api/v1/characters/search?q=Rina&filter=public&page=1&limit=20
```

#### 5. æµ‹è¯•å“åº”å¼å¸ƒå±€
- [ ] æ¡Œé¢è§†å›¾ï¼ˆ>1024pxï¼‰ï¼š3åˆ—ç½‘æ ¼
- [ ] å¹³æ¿è§†å›¾ï¼ˆ768-1024pxï¼‰ï¼š2åˆ—ç½‘æ ¼
- [ ] ç§»åŠ¨è§†å›¾ï¼ˆ<768pxï¼‰ï¼š1åˆ—ç½‘æ ¼ï¼Œå¯¼èˆªæ è‡ªåŠ¨æ”¶èµ·

#### 6. éªŒè¯ç©ºçŠ¶æ€
```javascript
// æœç´¢ä¸å­˜åœ¨çš„è§’è‰²
// è¾“å…¥: "NonExistentCharacter123"
// é¢„æœŸ: æ˜¾ç¤ºç©ºçŠ¶æ€é¡µé¢ï¼Œæç¤º"æœªæ‰¾åˆ°è§’è‰²"
```

### éªŒè¯æ ‡å‡†
- âœ… ä¸‰æ®µå¼å¸ƒå±€æ­£ç¡®æ˜¾ç¤º
- âœ… å·¦ä¾§å¯¼èˆªæ æ‚¬åœå±•å¼€/æ”¶èµ·æ­£å¸¸
- âœ… æœç´¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- âœ… API è¯·æ±‚æ­£ç¡®å‘é€ï¼ˆæ— éœ€è®¤è¯ï¼‰
- âœ… å“åº”å¼å¸ƒå±€åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹æ­£å¸¸
- âœ… ç©ºçŠ¶æ€é¡µé¢æ­£ç¡®æ˜¾ç¤º

### å…³é”®æ–‡ä»¶
```
src/client/pages/Market.vue                        # å¸‚åœºé¡µé¢ä¸»ç»„ä»¶
src/client/components/layout/LeftSidebar.vue       # å·¦ä¾§å¯¼èˆªæ 
src/client/components/market/SearchCombo.vue       # æœç´¢æ¡†ç»„åˆ
src/client/components/market/FilterToolbar.vue     # ç­›é€‰å·¥å…·æ 
src/client/components/market/EmptyState.vue        # ç©ºçŠ¶æ€é¡µé¢
src/client/components/character/CharacterCard.vue  # è§’è‰²å¡ç‰‡
```

### é¢„æœŸç»“æœ
- é¡µé¢å¸ƒå±€ç¬¦åˆè®¾è®¡æ–‡æ¡£ `docs/plans/2026-02-02-market-redesign.md`
- æ‰€æœ‰äº¤äº’åŠŸèƒ½æ­£å¸¸
- æ— æ§åˆ¶å°é”™è¯¯
- API è¯·æ±‚æˆåŠŸè¿”å›æ•°æ®

### æ•…éšœæ’æŸ¥
å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯
2. æ£€æŸ¥ Network æ ‡ç­¾çš„ API è¯·æ±‚
3. éªŒè¯åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
4. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æœ‰æµ‹è¯•æ•°æ®

---

## ğŸ¯ ä»»åŠ¡ #2: æµ‹è¯•æ³¨å†Œæµç¨‹

### ä»»åŠ¡æè¿°
éªŒè¯ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŒåŒ…æ‹¬è¡¨å•éªŒè¯ã€API è°ƒç”¨ã€è‡ªåŠ¨ç™»å½•å’Œæ•°æ®æŒä¹…åŒ–ã€‚

### å‰ç½®æ¡ä»¶
- âœ… åç«¯æœåŠ¡è¿è¡Œåœ¨ http://localhost:3000
- âœ… å‰ç«¯æœåŠ¡è¿è¡Œ
- âœ… PostgreSQL æ•°æ®åº“è¿æ¥æ­£å¸¸

### æ‰§è¡Œæ­¥éª¤

#### 1. è®¿é—®æ³¨å†Œé¡µé¢
```bash
# æµè§ˆå™¨è®¿é—®
# http://localhost:5173/register
# æˆ–
# http://localhost:5175/register
```

#### 2. æµ‹è¯•è¡¨å•éªŒè¯
- [ ] **ç”¨æˆ·åéªŒè¯**
  - ç•™ç©ºæäº¤ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º
  - è¾“å…¥å°‘äº3ä¸ªå­—ç¬¦ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º
  - è¾“å…¥ç‰¹æ®Šå­—ç¬¦ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º

- [ ] **é‚®ç®±éªŒè¯**
  - ç•™ç©ºæäº¤ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º
  - è¾“å…¥æ— æ•ˆé‚®ç®±æ ¼å¼ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º

- [ ] **å¯†ç éªŒè¯**
  - ç•™ç©ºæäº¤ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º
  - è¾“å…¥å°‘äº6ä¸ªå­—ç¬¦ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º

#### 3. æäº¤æ³¨å†Œè¡¨å•
```javascript
// æµ‹è¯•æ•°æ®
const testUser = {
  username: 'testuser_' + Date.now(),
  email: 'test_' + Date.now() + '@example.com',
  password: 'Test123456'
};

// å¡«å†™è¡¨å•å¹¶æäº¤
// è§‚å¯Ÿ Network æ ‡ç­¾
// é¢„æœŸè¯·æ±‚: POST /api/v1/auth/register
```

#### 4. éªŒè¯æ³¨å†Œå“åº”
```javascript
// é¢„æœŸå“åº”æ ¼å¼
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "username": "testuser_xxx",
      "email": "test_xxx@example.com"
    },
    "token": "jwt_token",
    "refreshToken": "refresh_token",
    "tenantId": "tenant_uuid"
  }
}
```

#### 5. éªŒè¯è‡ªåŠ¨ç™»å½•
- [ ] æ³¨å†ŒæˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µæˆ–å¸‚åœºé¡µé¢
- [ ] localStorage ä¸­ä¿å­˜äº†è®¤è¯ä¿¡æ¯

```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥
console.log('token:', localStorage.getItem('token'));
console.log('refreshToken:', localStorage.getItem('refreshToken'));
console.log('tenantId:', localStorage.getItem('tenantId'));
console.log('user:', localStorage.getItem('user'));

// é¢„æœŸ: æ‰€æœ‰å€¼éƒ½å­˜åœ¨ä¸”éç©º
```

#### 6. éªŒè¯åç»­ API è¯·æ±‚
```javascript
// åˆ·æ–°é¡µé¢ï¼Œè§‚å¯Ÿ Network æ ‡ç­¾
// é¢„æœŸ: æ‰€æœ‰ API è¯·æ±‚è‡ªåŠ¨æºå¸¦ä»¥ä¸‹å¤´éƒ¨
// Authorization: Bearer <token>
// X-Tenant-ID: <tenantId>
```

### éªŒè¯æ ‡å‡†
- âœ… è¡¨å•éªŒè¯æ­£å¸¸å·¥ä½œ
- âœ… æ³¨å†Œ API è°ƒç”¨æˆåŠŸ
- âœ… è¿”å›æ­£ç¡®çš„ç”¨æˆ·ä¿¡æ¯å’Œ token
- âœ… localStorage æ­£ç¡®ä¿å­˜è®¤è¯ä¿¡æ¯
- âœ… è‡ªåŠ¨ç™»å½•å¹¶è·³è½¬
- âœ… åç»­è¯·æ±‚æºå¸¦è®¤è¯å¤´

### å…³é”®æ–‡ä»¶
```
src/client/pages/auth/Register.vue      # æ³¨å†Œé¡µé¢
src/client/services/auth.ts             # è®¤è¯ API æœåŠ¡
src/client/stores/user.ts               # ç”¨æˆ·çŠ¶æ€ç®¡ç†
src/server/routes/auth.ts               # åç«¯è®¤è¯è·¯ç”±
src/server/services/auth.service.ts     # åç«¯è®¤è¯æœåŠ¡
```

### é¢„æœŸç»“æœ
- æ³¨å†ŒæˆåŠŸï¼Œç”¨æˆ·ä¿¡æ¯ä¿å­˜åˆ°æ•°æ®åº“
- è‡ªåŠ¨åˆ›å»ºç§Ÿæˆ·
- è‡ªåŠ¨ç™»å½•å¹¶è·³è½¬
- è®¤è¯ä¿¡æ¯æŒä¹…åŒ–åˆ° localStorage

### æ•…éšœæ’æŸ¥
å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ Network æ ‡ç­¾çš„è¯·æ±‚/å“åº”
3. éªŒè¯åç«¯æ—¥å¿—
4. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æˆåŠŸåˆ›å»ºç”¨æˆ·å’Œç§Ÿæˆ·

```bash
# æ£€æŸ¥æ•°æ®åº“
docker exec -it sillytavern-postgres psql -U postgres -d sillytavern_saas -c "SELECT id, username, email FROM users ORDER BY created_at DESC LIMIT 5;"
docker exec -it sillytavern-postgres psql -U postgres -d sillytavern_saas -c "SELECT id, name, owner_id FROM tenants ORDER BY created_at DESC LIMIT 5;"
```

---

## ğŸ¯ ä»»åŠ¡ #3: æµ‹è¯•ç™»å½•æµç¨‹

### ä»»åŠ¡æè¿°
éªŒè¯ç”¨æˆ·ç™»å½•åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŒåŒ…æ‹¬å‡­æ®éªŒè¯ã€token è·å–å’Œç§Ÿæˆ· ID ä¼ é€’ã€‚

### å‰ç½®æ¡ä»¶
- âœ… åç«¯æœåŠ¡è¿è¡Œ
- âœ… å‰ç«¯æœåŠ¡è¿è¡Œ
- âœ… å·²æœ‰æ³¨å†Œç”¨æˆ·ï¼ˆå¯ä½¿ç”¨ä»»åŠ¡ #2 åˆ›å»ºçš„ç”¨æˆ·ï¼‰

### æ‰§è¡Œæ­¥éª¤

#### 1. å‡†å¤‡æµ‹è¯•è´¦å·
```bash
# å¦‚æœä»»åŠ¡ #2 å·²å®Œæˆï¼Œä½¿ç”¨è¯¥è´¦å·
# å¦åˆ™ï¼Œå…ˆæ³¨å†Œä¸€ä¸ªæµ‹è¯•è´¦å·
```

#### 2. æ¸…ç† localStorage
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.clear();
console.log('localStorage cleared');

// åˆ·æ–°é¡µé¢ï¼ŒéªŒè¯å·²ç™»å‡ºçŠ¶æ€
```

#### 3. è®¿é—®ç™»å½•é¡µé¢
```bash
# æµè§ˆå™¨è®¿é—®
# http://localhost:5173/login
# æˆ–
# http://localhost:5175/login
```

#### 4. æµ‹è¯•è¡¨å•éªŒè¯
- [ ] **é‚®ç®±éªŒè¯**
  - ç•™ç©ºæäº¤ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º
  - è¾“å…¥æ— æ•ˆé‚®ç®± â†’ æ˜¾ç¤ºé”™è¯¯æç¤º

- [ ] **å¯†ç éªŒè¯**
  - ç•™ç©ºæäº¤ â†’ æ˜¾ç¤ºé”™è¯¯æç¤º

- [ ] **é”™è¯¯å‡­æ®**
  - è¾“å…¥é”™è¯¯å¯†ç  â†’ æ˜¾ç¤º"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯"

#### 5. æäº¤ç™»å½•è¡¨å•
```javascript
// ä½¿ç”¨æ­£ç¡®çš„æµ‹è¯•è´¦å·
// è§‚å¯Ÿ Network æ ‡ç­¾
// é¢„æœŸè¯·æ±‚: POST /api/v1/auth/login
```

#### 6. éªŒè¯ç™»å½•å“åº”
```javascript
// é¢„æœŸå“åº”æ ¼å¼
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "username": "testuser",
      "email": "test@example.com"
    },
    "token": "jwt_token",
    "refreshToken": "refresh_token",
    "tenantId": "tenant_uuid"
  }
}
```

#### 7. éªŒè¯è®¤è¯çŠ¶æ€
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥
console.log('token:', localStorage.getItem('token'));
console.log('refreshToken:', localStorage.getItem('refreshToken'));
console.log('tenantId:', localStorage.getItem('tenantId'));
console.log('user:', localStorage.getItem('user'));

// é¢„æœŸ: æ‰€æœ‰å€¼éƒ½å­˜åœ¨ä¸”éç©º
```

#### 8. éªŒè¯ API è¯·æ±‚å¤´
```javascript
// è®¿é—®éœ€è¦è®¤è¯çš„é¡µé¢ï¼ˆå¦‚"æˆ‘çš„è§’è‰²"ï¼‰
// è§‚å¯Ÿ Network æ ‡ç­¾çš„ API è¯·æ±‚
// é¢„æœŸ: æ‰€æœ‰è¯·æ±‚æºå¸¦ä»¥ä¸‹å¤´éƒ¨
// Authorization: Bearer <token>
// X-Tenant-ID: <tenantId>
```

#### 9. æµ‹è¯•é¡µé¢åˆ·æ–°
```javascript
// åˆ·æ–°é¡µé¢
// é¢„æœŸ: ä¿æŒç™»å½•çŠ¶æ€ï¼Œä¸è·³è½¬åˆ°ç™»å½•é¡µ
```

### éªŒè¯æ ‡å‡†
- âœ… è¡¨å•éªŒè¯æ­£å¸¸å·¥ä½œ
- âœ… ç™»å½• API è°ƒç”¨æˆåŠŸ
- âœ… è¿”å›æ­£ç¡®çš„ç”¨æˆ·ä¿¡æ¯å’Œ token
- âœ… localStorage æ­£ç¡®ä¿å­˜è®¤è¯ä¿¡æ¯
- âœ… ç™»å½•åè·³è½¬åˆ°é¦–é¡µæˆ–å¸‚åœºé¡µé¢
- âœ… åç»­è¯·æ±‚æºå¸¦ Authorization å’Œ X-Tenant-ID å¤´
- âœ… é¡µé¢åˆ·æ–°åä¿æŒç™»å½•çŠ¶æ€

### å…³é”®æ–‡ä»¶
```
src/client/pages/auth/Login.vue         # ç™»å½•é¡µé¢
src/client/services/auth.ts             # è®¤è¯ API æœåŠ¡
src/client/services/api.ts              # API å®¢æˆ·ç«¯ï¼ˆè¯·æ±‚æ‹¦æˆªå™¨ï¼‰
src/client/stores/user.ts               # ç”¨æˆ·çŠ¶æ€ç®¡ç†
src/server/routes/auth.ts               # åç«¯è®¤è¯è·¯ç”±
src/server/middleware/auth.ts           # è®¤è¯ä¸­é—´ä»¶
src/server/middleware/tenant.ts         # ç§Ÿæˆ·ä¸­é—´ä»¶
```

### é¢„æœŸç»“æœ
- ç™»å½•æˆåŠŸï¼Œè·å– token å’Œ tenantId
- è®¤è¯ä¿¡æ¯æŒä¹…åŒ–åˆ° localStorage
- åç»­ API è¯·æ±‚è‡ªåŠ¨æºå¸¦è®¤è¯å¤´
- é¡µé¢åˆ·æ–°åä¿æŒç™»å½•çŠ¶æ€

### æ•…éšœæ’æŸ¥
å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ Network æ ‡ç­¾çš„è¯·æ±‚/å“åº”
3. éªŒè¯ token æ˜¯å¦æœ‰æ•ˆ
4. æ£€æŸ¥ API æ‹¦æˆªå™¨æ˜¯å¦æ­£ç¡®æ·»åŠ å¤´éƒ¨

```bash
# æµ‹è¯•ç™»å½• API
curl -X POST http://localhost:3000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"Test123456"}'
```

---

## ğŸ¯ ä»»åŠ¡ #4: æµ‹è¯•ç™»å‡ºæµç¨‹

### ä»»åŠ¡æè¿°
éªŒè¯ç”¨æˆ·ç™»å‡ºåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼ŒåŒ…æ‹¬ localStorage æ¸…ç†å’Œé¡µé¢è·³è½¬ã€‚

### å‰ç½®æ¡ä»¶
- âœ… åç«¯æœåŠ¡è¿è¡Œ
- âœ… å‰ç«¯æœåŠ¡è¿è¡Œ
- âœ… ç”¨æˆ·å·²ç™»å½•ï¼ˆå¯ä½¿ç”¨ä»»åŠ¡ #3 ç™»å½•ï¼‰

### æ‰§è¡Œæ­¥éª¤

#### 1. ç¡®è®¤ç™»å½•çŠ¶æ€
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥
console.log('Before logout:');
console.log('token:', localStorage.getItem('token'));
console.log('tenantId:', localStorage.getItem('tenantId'));

// é¢„æœŸ: æœ‰å€¼
```

#### 2. æ‰¾åˆ°ç™»å‡ºæŒ‰é’®
- [ ] ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·èœå•
- [ ] æ‰¾åˆ°"é€€å‡ºç™»å½•"é€‰é¡¹

#### 3. æ‰§è¡Œç™»å‡º
```javascript
// ç‚¹å‡»"é€€å‡ºç™»å½•"
// è§‚å¯Ÿ Network æ ‡ç­¾
// å¯èƒ½çš„è¯·æ±‚: POST /api/v1/auth/logoutï¼ˆå¦‚æœåç«¯å®ç°äº†ï¼‰
```

#### 4. éªŒè¯ localStorage æ¸…ç†
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ£€æŸ¥
console.log('After logout:');
console.log('token:', localStorage.getItem('token'));
console.log('refreshToken:', localStorage.getItem('refreshToken'));
console.log('tenantId:', localStorage.getItem('tenantId'));
console.log('user:', localStorage.getItem('user'));

// é¢„æœŸ: æ‰€æœ‰å€¼éƒ½ä¸º null
```

#### 5. éªŒè¯é¡µé¢è·³è½¬
- [ ] ç™»å‡ºåè‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ `/`
- [ ] æˆ–è·³è½¬åˆ°ç™»å½•é¡µ `/login`

#### 6. éªŒè¯è®¤è¯çŠ¶æ€
```javascript
// å°è¯•è®¿é—®éœ€è¦è®¤è¯çš„é¡µé¢
// ä¾‹å¦‚: http://localhost:5173/characters
// é¢„æœŸ: è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ
```

#### 7. æµ‹è¯•åç»­ API è¯·æ±‚
```javascript
// è®¿é—®å¸‚åœºé¡µé¢ï¼ˆå…¬å¼€é¡µé¢ï¼‰
// è§‚å¯Ÿ Network æ ‡ç­¾
// é¢„æœŸ: API è¯·æ±‚ä¸æºå¸¦ Authorization å’Œ X-Tenant-ID å¤´
```

### éªŒè¯æ ‡å‡†
- âœ… ç™»å‡ºæŒ‰é’®å¯ç‚¹å‡»
- âœ… localStorage å®Œå…¨æ¸…ç©º
- âœ… è‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µæˆ–ç™»å½•é¡µ
- âœ… æ— æ³•è®¿é—®éœ€è¦è®¤è¯çš„é¡µé¢
- âœ… åç»­è¯·æ±‚ä¸æºå¸¦è®¤è¯å¤´
- âœ… æ— æ§åˆ¶å°é”™è¯¯

### å…³é”®æ–‡ä»¶
```
src/client/components/layout/AppHeader.vue  # ç”¨æˆ·èœå•å’Œç™»å‡ºæŒ‰é’®
src/client/stores/user.ts                   # ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆlogout æ–¹æ³•ï¼‰
src/client/router/index.ts                  # è·¯ç”±å®ˆå«
```

### é¢„æœŸç»“æœ
- ç™»å‡ºæˆåŠŸï¼Œè®¤è¯ä¿¡æ¯å®Œå…¨æ¸…é™¤
- è‡ªåŠ¨è·³è½¬åˆ°å…¬å¼€é¡µé¢
- æ— æ³•è®¿é—®éœ€è¦è®¤è¯çš„é¡µé¢
- å¯ä»¥é‡æ–°ç™»å½•

### æ•…éšœæ’æŸ¥
å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æ§åˆ¶å°é”™è¯¯ä¿¡æ¯
2. éªŒè¯ localStorage æ˜¯å¦æ¸…ç©º
3. æ£€æŸ¥è·¯ç”±å®ˆå«æ˜¯å¦æ­£ç¡®å·¥ä½œ
4. éªŒè¯ç™»å‡ºé€»è¾‘æ˜¯å¦å®Œæ•´

```javascript
// æ‰‹åŠ¨æµ‹è¯•ç™»å‡ºé€»è¾‘
// åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ
localStorage.clear();
window.location.href = '/';
```

---

## ğŸ“Š ä»»åŠ¡æ‰§è¡Œå»ºè®®

### æ‰§è¡Œé¡ºåº
å»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œä»»åŠ¡ï¼š
1. **ä»»åŠ¡ #1** (æµ‹è¯•è§’è‰²å¸‚åœºé¡µé¢) - éªŒè¯åŸºç¡€å¸ƒå±€å’Œå…¬å¼€åŠŸèƒ½
2. **ä»»åŠ¡ #2** (æµ‹è¯•æ³¨å†Œæµç¨‹) - åˆ›å»ºæµ‹è¯•è´¦å·
3. **ä»»åŠ¡ #3** (æµ‹è¯•ç™»å½•æµç¨‹) - éªŒè¯è®¤è¯æµç¨‹
4. **ä»»åŠ¡ #4** (æµ‹è¯•ç™»å‡ºæµç¨‹) - éªŒè¯æ¸…ç†é€»è¾‘

### å¹¶è¡Œæ‰§è¡Œ
å¦‚æœæœ‰å¤šä¸ªå­ä¼šè¯ï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼š
- **ä¼šè¯ A**: ä»»åŠ¡ #1 (æ— éœ€è®¤è¯)
- **ä¼šè¯ B**: ä»»åŠ¡ #2 â†’ #3 â†’ #4 (éœ€è¦é¡ºåºæ‰§è¡Œ)

### æµ‹è¯•ç¯å¢ƒ
- **æµè§ˆå™¨**: æ¨èä½¿ç”¨ Chrome æˆ– Firefoxï¼ˆå¼€å‘è€…å·¥å…·æ›´å‹å¥½ï¼‰
- **ç½‘ç»œ**: æœ¬åœ°ç¯å¢ƒï¼Œæ— éœ€å¤–ç½‘
- **æ•°æ®**: ä½¿ç”¨æµ‹è¯•æ•°æ®ï¼Œä¸å½±å“ç”Ÿäº§ç¯å¢ƒ

### æŠ¥å‘Šæ ¼å¼
æ¯ä¸ªä»»åŠ¡å®Œæˆåï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š
1. **ä»»åŠ¡çŠ¶æ€**: âœ… é€šè¿‡ / âŒ å¤±è´¥ / âš ï¸ éƒ¨åˆ†é€šè¿‡
2. **éªŒè¯ç»“æœ**: åˆ—å‡ºæ‰€æœ‰éªŒè¯é¡¹çš„ç»“æœ
3. **å‘ç°çš„é—®é¢˜**: è¯¦ç»†æè¿°ä»»ä½• Bug æˆ–å¼‚å¸¸
4. **æˆªå›¾**: å…³é”®é¡µé¢å’Œé”™è¯¯ä¿¡æ¯çš„æˆªå›¾
5. **å»ºè®®**: æ”¹è¿›å»ºè®®æˆ–åç»­å·¥ä½œ

---

## ğŸ”§ é€šç”¨å·¥å…·å’Œå‘½ä»¤

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥åç«¯
curl http://localhost:3000/health

# æ£€æŸ¥å‰ç«¯ç«¯å£
lsof -ti:5173 && echo "Frontend on 5173" || lsof -ti:5175 && echo "Frontend on 5175"

# æ£€æŸ¥æ•°æ®åº“
docker ps | grep postgres

# æ£€æŸ¥ Redis
docker ps | grep redis
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# åç«¯æ—¥å¿—ï¼ˆåœ¨è¿è¡Œ npm run dev çš„ç»ˆç«¯æŸ¥çœ‹ï¼‰

# æ•°æ®åº“æ—¥å¿—
docker logs sillytavern-postgres --tail 50

# Redis æ—¥å¿—
docker logs sillytavern-redis --tail 50
```

### æ•°æ®åº“æŸ¥è¯¢
```bash
# æŸ¥çœ‹ç”¨æˆ·
docker exec -it sillytavern-postgres psql -U postgres -d sillytavern_saas -c "SELECT id, username, email, created_at FROM users ORDER BY created_at DESC LIMIT 10;"

# æŸ¥çœ‹ç§Ÿæˆ·
docker exec -it sillytavern-postgres psql -U postgres -d sillytavern_saas -c "SELECT id, name, owner_id, created_at FROM tenants ORDER BY created_at DESC LIMIT 10;"

# æŸ¥çœ‹è§’è‰²
docker exec -it sillytavern-postgres psql -U postgres -d sillytavern_saas -c "SELECT id, name, visibility, tenant_id FROM characters ORDER BY created_at DESC LIMIT 10;"
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯åç«¯
cd /var/aichat/Small-Squaretable
pkill -f "tsx watch"
npm run dev

# é‡å¯å‰ç«¯
pkill -f "vite"
npm run dev:client
```

---

## ğŸ“ é—®é¢˜ä¸ŠæŠ¥

å¦‚æœé‡åˆ°ä»¥ä¸‹æƒ…å†µï¼Œè¯·ç«‹å³ä¸ŠæŠ¥ä¸»ä¼šè¯ï¼š
1. **æœåŠ¡æ— æ³•å¯åŠ¨** - åç«¯æˆ–å‰ç«¯æœåŠ¡å¯åŠ¨å¤±è´¥
2. **æ•°æ®åº“è¿æ¥å¤±è´¥** - PostgreSQL æˆ– Redis è¿æ¥é”™è¯¯
3. **ä¸¥é‡ Bug** - å¯¼è‡´åº”ç”¨å´©æºƒæˆ–æ— æ³•ä½¿ç”¨çš„é”™è¯¯
4. **å®‰å…¨é—®é¢˜** - å‘ç°æ½œåœ¨çš„å®‰å…¨æ¼æ´
5. **æ¶æ„é—®é¢˜** - å‘ç°è®¾è®¡æˆ–æ¶æ„å±‚é¢çš„é—®é¢˜

---

**æ–‡æ¡£ç»´æŠ¤è€…**: Claude Code (ä¸»ä¼šè¯)
**æœ€åæ›´æ–°**: 2026-02-03
**ä¸‹æ¬¡æ›´æ–°**: æ‰€æœ‰ä»»åŠ¡å®Œæˆå
