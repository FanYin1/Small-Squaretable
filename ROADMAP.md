# Small Squaretable - 开发路线图

**项目**: SillyTavern SaaS 转换
**版本**: 0.1.0
**最后更新**: 2026-02-06

---

## 📊 项目状态

```
Phase 1: 基础设施层        ████████████████████ 100% ✅
Phase 2: 核心 API          ████████████████████ 100% ✅
Phase 3: 订阅与计费        ████████████████████ 100% ✅
Phase 4: 前端基础          ████████████████████ 100% ✅
Phase 5: 前端页面开发      ████████████████████ 100% ✅
Phase 6: 测试与优化        ████████████████████ 100% ✅
Phase 7: 生产部署          ████████████████████ 100% ✅
```

**整体完成度**: 100% - 生产就绪

---

## Phase 1: 基础设施层 ✅

- PostgreSQL + Drizzle ORM (8 张表)
- Redis 缓存层
- 中间件系统 (租户、错误处理、日志)
- Repository 模式 (8 个仓库)
- 测试框架 (Vitest)

## Phase 2: 核心 API ✅

- JWT 认证系统 (双 Token)
- 用户管理 API
- 角色管理 API (CRUD + 市场)
- 聊天管理 API
- 五维度评分系统
- PostgreSQL 全文搜索
- WebSocket 实时通信
- LLM 集成

## Phase 3: 订阅与计费 ✅

- Stripe 集成
- 三层订阅计划 (Free/Pro/Team)
- 订阅管理 API
- 使用量跟踪系统
- 功能门控系统
- Webhook 处理

## Phase 4: 前端基础 ✅

- Vue 3 + Vite 项目
- 路由系统 (Vue Router)
- 状态管理 (Pinia)
- API 服务层
- 布局组件
- UI 组件库 (Element Plus)

## Phase 5: 前端页面开发 ✅

- 认证页面 (Login/Register)
- 核心页面 (Home, Market, Chat, Profile, Subscription)
- 角色市场 (三段式控制台布局)
- SillyTavern V2 角色卡导入
- Toast 通知系统
- 空状态设计

## Phase 6: 测试与优化 ✅

- E2E 测试 (Playwright, 92% 通过率)
- 单元测试 (Vitest, 99% 通过率)
- 安全加固 (CSRF, CSP, 速率限制)
- 性能优化 (代码分割, 缓存, 懒加载)
- 监控与日志 (Sentry, 结构化日志)

## Phase 7: 生产部署 ✅

- Docker 镜像优化 (多阶段构建)
- Kubernetes 配置 (Kustomize)
- CI/CD 流程 (GitHub Actions)
- 数据库备份与恢复
- 灾难恢复计划

---

## 🚀 后续迭代计划

### 迭代 1: 高级功能
- 多模态体验 (图片、语音支持)
- ✅ **智能角色系统 (记忆、情感状态机)** - 2026-02-05 完成
  - pgvector 向量搜索 + 混合检索
  - 2D Valence-Arousal 情感模型
  - MiniLM 本地嵌入 + 情感分析
  - 系统提示注入
- ✅ **智能系统调试面板** - 2026-02-06 完成
  - 实时 WebSocket 事件推送
  - 系统提示查看器 (Token 计数)
  - 记忆检索日志 (分数分解)
  - 情感时间线图表 (Valence/Arousal)
  - 性能指标监控
- ✅ **智能系统集成修复** - 2026-02-06 完成
  - WebSocket 消息流集成记忆/情感系统
  - 记忆提取频率改为每条消息立即提取
  - Token 过期时间延长至 6 小时
  - 聊天会话持久化 (localStorage)
  - 自动滚动修复
- ✅ **ML 微服务代理支持** - 2026-02-06 完成
  - 使用 undici ProxyAgent 支持 HTTP/HTTPS 代理
  - 自动检测 HTTP_PROXY/HTTPS_PROXY 环境变量
  - 解决 Node.js 原生 fetch 不支持代理的问题
- ✅ **会话隔离** - 2026-02-06 完成
  - 记忆按 chatId 隔离存储和检索
  - 情感状态按 chatId 独立追踪
  - 数据库部分唯一索引支持 upsert 操作
- 多设备同步
- 移动端 PWA 优化

### 迭代 2: 社区与生态
- 社交功能 (关注、收藏、评论)
- 插件系统架构
- 开发者 API 门户
- Webhook 系统

### 迭代 3: 数据智能
- 用户画像与分群
- 推荐算法
- A/B 测试框架
- 数据分析仪表盘

---

## 📈 技术指标

| 指标 | 数值 |
|------|------|
| 代码行数 | ~31,000 行 |
| 单元测试 | 526 通过 (94%) |
| E2E 测试 | 22/24 通过 (92%) |
| API 端点 | 40+ |
| 数据库表 | 10 张 |

---

## 📅 时间线

```
2026-01-31  Phase 1-2 完成
2026-02-01  Phase 3-4 完成
2026-02-03  Phase 5 完成
2026-02-04  Phase 6 完成
2026-02-05  Phase 7 完成 + 智能角色系统
2026-02-06  智能系统调试面板 + 系统集成修复 ← 当前
```
